<!DOCTYPE html>
<html>
<head>
  <title>Sample Page</title>
</head>
<body>
<button id="btn">Click Me</button>
<hr />
<pre id="output">
</pre>
<script>
function getApiInfo() {
  var cookies =
    document.cookie.split(';').map(function(cookie) {
      var parts = cookie.split('=');
      return { name: parts[0].trim(), value: decodeURIComponent(parts[1]) };
    })
    .filter(function(cookie) {
      return cookie.name == 'api';
    });

  if (cookies.length) {
    return JSON.parse(cookies[0].value);
  }

  return null;
}

function invokeApi() {
  var url = '/api/data';

  var api = getApiInfo();
  if (api) {
    url = 'http://' + api.domain + url;
  }

  var xhr = new XMLHttpRequest();
  xhr.open('POST', url, true);
  xhr.setRequestHeader('Content-Type', 'application/json');
  if (api) {
    xhr.setRequestHeader('Authorization', api.auth);
  }
  xhr.onreadystatechange = function() {
    if (xhr.readyState == 4) {
      var status = xhr.status;
      var data = xhr.responseText;

      document.getElementById('output').textContent =
        status + '\n----\n' + data;
    }
  }

  var input = JSON.stringify({ timestamp: new Date() });
  xhr.send(input);
}

document.getElementById('btn').addEventListener('click', invokeApi, false);
</script>
</html>
