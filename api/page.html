<!DOCTYPE html>
<html>
<head>
  <title>Sample Page</title>
</head>
<body>
<button id="btn">Click Me</button>
<hr />
<pre id="output">
</pre>
<script>
function getApiInfo() {
  var apiDomain = '';
  var apiAuth = '';

  var cookies =
    document.cookie.split(';').map(function(cookie) {
      var parts = cookie.split('=');
      return { name: parts[0].trim(), value: decodeURIComponent(parts[1]) };
    })

  var authCookies = cookies.filter(function(cookie) {
    return cookie.name == 'auth';
  });
  var apiCookies = cookies.filter(function(cookie) {
    return cookie.name == 'api';
  });

  if (authCookies.length) {
    apiAuth = authCookies[0].value;
  }
  if (apiCookies.length) {
    apiDomain = '//' + apiCookies[0].value;
  }

  return {
    endpoint: apiDomain + '/api/data',
    auth: apiAuth
  };
}

function invokeApi() {
  var api = getApiInfo();

  var xhr = new XMLHttpRequest();
  xhr.open('POST', api.endpoint, true);
  xhr.setRequestHeader('Content-Type', 'application/json');
  if (api.auth) {
    xhr.setRequestHeader('Authorization', api.auth);
  }
  xhr.onreadystatechange = function() {
    if (xhr.readyState == 4) {
      var status = xhr.status;
      var data = xhr.responseText;

      document.getElementById('output').textContent =
        status + '\n----\n' + data;
    }
  }

  var input = JSON.stringify({ timestamp: new Date() });
  xhr.send(input);
}

document.getElementById('btn').addEventListener('click', invokeApi, false);
</script>
</html>
